# GitLab服务器切换通知以及迁移指南

## 切换通知

由于原GitLab服务器部署的应用系统一部机房不能保证7*24高可用，所以将迁移到阿里云服务器上。

|                | 服务地址                     | GitLab版本 |
| -------------- | ---------------------------- | ---------- |
| 原GitLab服务器 | http://218.240.159.110:10080 | 8.0        |
| 新GitLab服务器 | http://47.93.34.153:10080    | 11.0       |

## 迁移指南

步骤：

1. 添加新用户
2. 添加SSH证书
3. 更换本地项目的git仓库设置

### 添加新用户

步骤：

1. 打开http://47.93.34.153:10080
2. 注册新用户，用你的真实姓名的拼音或者你的昵称（使用昵称的，在群里通告一下，让大家熟知你的昵称）
3. 申请好了之后，在大同的成员找段雅琴，在北京的同事找刘进行开通访问newoa群组的访问权限

### 添加SSH证书

本地git仓库与GitLab服务器的交互，统一使用`SSH`协议，而非`http`协议（http协议通道即将关闭）。所以本次迁移git，必须设定SSH证书。

步骤：

1. 生成证书
2. 在GitLab上添加证书

#### 生成证书

打开git bash（按win键，然后输入git bash，会搜索出git bash），输入`SSH-keygen`命令。这个命令中出现的任何输入提示，直接按回车键即可，特别是提示输入密码时，一定不要输入任何密码，直接按回车键。这样，最终会生成证书，公钥证书存放在`~/.SSH/rsa.pub`（`~`表示用户目录）。

#### 在GitLab上添加证书

登录GitLab，打开http://47.93.34.153:10080/profile/keys这个链接，在出现的页面中添加证书：将`~/.SSH/rsa.pub`的内容拷贝到`key`表单项中，点击保存即可。

#### 温馨提示：为什么鼓励使用SSH呢？

首先说一下历史渊源，git诞生时，基本上只有SSH协议支持写权限，而其他协议如HTTP协议、Git协议只支持读取权限。随着GitLab等git服务器出现，这个限制已经不存在了。但是SSH协议作为git的主要传输协议的地位还是不可动摇的。

另外，说说SSH协议的好处：

* Git的SSH协议搭建起来相对简单，如果GitLab服务不好使了，我们可以快速搭建一个轻量级的git远程仓库，作为备用。
* 通过 SSH 进行访问是安全的 — 所有数据传输都是加密和授权的。
* SSH很高效，会在传输之前尽可能压缩数据。

### 更换本地项目的git仓库设置

打开newoa项目，运行如下的命令行，切换到新的GitLab仓库：

```shell
git remote set-url origin ssh://git@47.93.34.153:10022/newoa/newoa.git
```

